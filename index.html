<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Sterownik Akwarystyczny (MQTT)</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f0f8ff; margin: 20px; }
    h1 { color: #0066cc; }
    h2 { color: #004c99; }
    .section { background: #ffffff; padding: 15px; margin-bottom: 15px; border-radius: 8px; box-shadow: 0px 2px 5px rgba(0,0,0,0.1); }
    button { padding: 8px 12px; background: #0066cc; color: white; border: none; border-radius: 4px; cursor: pointer; }
    button:hover { background: #004c99; }
    input[type='text'] { padding: 5px; border: 1px solid #ccc; border-radius: 4px; width: 40px; }
  </style>
</head>
<body>

<h1>Sterownik Akwarystyczny (MQTT)</h1>
<p>Czas lokalny: <strong><span id="localTime">--:--</span></strong></p>

<div class="section">
  <h2>Karmienie</h2>
  <p>Karmienie 1: <strong><span id="feed1">--:--</span></strong></p>
  <p>Karmienie 2: <strong><span id="feed2">--:--</span></strong></p>
  <p>Odliczanie: <strong><span id="nextFeed">--:--</span></strong></p>
</div>

<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
<script>
  let feed1Str = "--:--";
  let feed2Str = "--:--";

  function updateCountdown() {
    if (feed1Str === "--:--" || feed2Str === "--:--") return;
    
    const now = new Date();
    const currentSeconds = now.getHours() * 3600 + now.getMinutes() * 60 + now.getSeconds();
    
    const [h1, m1] = feed1Str.split(":" ).map(Number);
    const [h2, m2] = feed2Str.split(":" ).map(Number);
    
    const feed1Seconds = h1 * 3600 + m1 * 60;
    const feed2Seconds = h2 * 3600 + m2 * 60;
    
    let nextFeedSeconds;
    if (currentSeconds < feed1Seconds) {
      nextFeedSeconds = feed1Seconds;
    } else if (currentSeconds < feed2Seconds) {
      nextFeedSeconds = feed2Seconds;
    } else {
      nextFeedSeconds = feed1Seconds + 86400; // Następny dzień
    }
    
    const diff = nextFeedSeconds - currentSeconds;
    const hours = Math.floor(diff / 3600);
    const mins = Math.floor((diff % 3600) / 60);
    const secs = diff % 60;
    document.getElementById("nextFeed").innerText = `${hours}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
  }

  setInterval(updateCountdown, 1000);
</script>

</body>
</html>
