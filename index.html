<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Sterownik Akwarystyczny (MQTT)</title>
</head>
<body>
  <h1>Akwarium MQTT</h1>
  <p>Czas: <span id="localTime">--:--</span></p>
  <p>Temperatura: <span id="temp">--</span>°C / Cel: <span id="target">--</span>°C</p>

  <button onclick="publish('aquarium/light','on')">Światło ON</button>
  <button onclick="publish('aquarium/light','off')">Światło OFF</button>
  <br><br>

  <button onclick="publish('aquarium/pump','on')">Pompka ON</button>
  <button onclick="publish('aquarium/pump','off')">Pompka OFF</button>
  <br><br>

  <input id="setTemp" placeholder="25.0"> <button onclick="setTemp()">Ustaw temp</button>
  <br><br>

  <input id="h1">:<input id="m1"> <input id="h2">:<input id="m2">
  <button onclick="setFeed()">Ustaw karmienie</button>
  <br><br>

  <button onclick="publish('aquarium/feed','now')">Podaj pokarm</button>

  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
  <script>
    const client = mqtt.connect("wss://58ec15cbf38243588a5903e2ad4e9c1c.s1.eu.hivemq.cloud:8884/mqtt", {
      clientId: "WebClient_" + Math.random().toString(16).substr(2, 8),
      username: "Strona",  // wpisz swój login
      password: "Haslo123"  // wpisz swoje hasło
    });

    client.on("connect", () => {
      client.subscribe("aquarium/status");
    });

    client.on("message", (topic, msg) => {
      const data = JSON.parse(msg.toString());
      document.getElementById("temp").innerText = data.temp.toFixed(1);
      document.getElementById("target").innerText = data.target.toFixed(1);
      if (data.time) document.getElementById("localTime").innerText = data.time;
    });

    function publish(topic, message) {
      client.publish(topic, message);
    }

    function setTemp() {
      const val = document.getElementById("setTemp").value;
      if (val) publish("aquarium/heater/set", val);
    }

    function setFeed() {
      const h1 = document.getElementById("h1").value;
      const m1 = document.getElementById("m1").value;
      const h2 = document.getElementById("h2").value;
      const m2 = document.getElementById("m2").value;
      publish("aquarium/feedtimes/set", `${h1},${m1},${h2},${m2}`);
    }
  </script>
</body>
</html>
